<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PTA | Events</title>
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="../stylesheets/navbar.css" />
  <link rel="stylesheet" type="text/css" href="../stylesheets/events-details.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body class="container">
  <div class="header">
    <div class="navbar">
      <a href="/home"><img src="/images/logo.png" class="logo" alt="Logo"></a>
      <ul class="tabs">
        <li class="home"><a href="/home">Home</a></li>
        <li class="athletes"><a href="/athletes">Athletes</a></li>
        <li class="clubs"><a href="/clubs">Clubs</a></li>
        <li class="events"><a href="/events">Events</a></li>
        <li class="membership"><a href="/membership">Membership</a></li>
        <li class="forum"><a href="/forum">Forum</a></li>
        <li class="notifications">
          <a href="/notifications">Notifications
            {{#if notifications}}
            <span class="badge">{{notifications.length}}</span>
            {{/if}}
          </a>
        </li>
        <li class="analytics"><a href="analytics">Analytics</a></li>
        <li class="profile-pic">
          {{#if user.profilepic}}
          <a href="#" onclick="toggleDropdown()"><img src="{{user.profilepic}}" alt="Profile Picture"
              class="profile-picture"></a>
          {{else}}
          <a href="#" onclick="toggleDropdown()" class="profile-picture"><img src="/images/none.jpg"
              alt="Profile Picture" class="profile-picture"></a>
          {{/if}}
          <div id="dropdown" class="dropdown-content">
            <a href="/profile">Profile</a>
            <a href="/settings">Settings</a>
            <a href="/help-center">FAQs</a>
            <a href="/">Logout</a>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <div class="events-container">
    <img src="{{event.eventpicture}}" alt="Event Picture">
    <div class="eventname">
      <span class="name">{{event.name}}</span>
    </div>

    <div class="clubtabs">
      <ul>
        <li><a href="#" id="details-tab">Details</a></li>
        <li><a href="#" id="participants-tab">Participants</a></li>
        {{#if user.ptaverified}}
        <li><a href="#" id="registrations-tab">Registrations</a></li>
        {{/if}}
        {{#if (or currentregistrant user.ptaverified)}}
        <li><a href="#" id="announcements-tab">Announcements</a></li>
        {{/if}}
      </ul>
    </div><br>

    <div class="eventsides">
      <div class="eventleftside">
        <div class="intro">
          <div class="details">
            <div class="titleandbuttons">
              <span>Details</span>
              {{#if user.ptaverified}}
              <button class="edit-button" onclick="openModal()"></button>
              <button class="deleteevent-button" onclick="confirmDelete()"></button>
              <div class="confirmdeletescreen" style="display: none;">
                Are you sure you <br>want to delete this event?<br>
                  <form action="/delete-event/{{event.id}}" method="post">
                  <button class="yesdelete" type="submit">Yes</button>
                  </form>
                <button class="nodelete" onclick="cancelDelete()">No</button>
              </div>
              {{/if}}
            </div>
          </div>
            <p>{{event.description}}</p>
            <p><strong>Time:</strong> {{formatTime event.starttime "h:mm A"}} - {{formatTime event.endtime "h:mm A"}}</p>
            <p><strong>Location:</strong> {{event.location}}</p>
            <p><strong>Gender:</strong> {{event.gender}}</p>
            <p><strong>Belt Level:</strong> {{event.beltlevel}}</p>
            <p><strong>Age Division:</strong> {{event.agedivision}}</p>
            <p><strong>Weight Class:</strong> {{event.weightclass}}</p>
            <p><strong>Event Type:</strong> {{event.eventtype}}</p>
            <p><strong>Registration Cap:</strong> {{registrationcount}} / {{event.registrationcap}}</p>

        </div>
      </div>

      <div id="editmodal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>

          <form id="eventform" class="event-form" action="/update-event" method="post" enctype="multipart/form-data">

            <div class="form-group">
              <label for="eventstatus">Event Status:</label>
              <select id="eventstatus" name="status">
                <option value="Active" {{#if (eq event.status "Active" )}}selected{{/if}}>Active</option>
                <option value="Cancelled" {{#if (eq event.status "Cancelled" )}}selected{{/if}}>Cancelled
                </option>
              </select>
            </div>

            <input type="hidden" name="eventid" value="{{event.id}}">
            <input type="hidden" value="{{event.eventtype}}" name="eventtype">
            <div class="eventpic">
              <input type="file" name="eventpicture">
            </div>
            <div class="form-group">
              <label for="name">Event Name:</label>
              <input type="text" id="name" name="name" value="{{event.name}}" required>
            </div>
            <div class="form-group">
              <label for="description">Event Description:</label>
              <textarea id="description" name="description" rows="4" required>{{event.description}}</textarea>
            </div>
            <div class="form-group">
              <label for="beltlevel">Belt Level:</label>
              <select id="beltlevel" name="beltlevel" rows="4">
                <option value="white" {{#if (eq event.beltlevel "white")}}selected{{/if}}>White</option>
                <option value="yellow" {{#if (eq event.beltlevel "yellow")}}selected{{/if}}>Yellow</option>
                <option value="green" {{#if (eq event.beltlevel "green")}}selected{{/if}}>Green</option>
                <option value="blue" {{#if (eq event.beltlevel "blue")}}selected{{/if}}>Blue</option>
                <option value="red" {{#if (eq event.beltlevel "red")}}selected{{/if}}>Red</option>
                <option value="black" {{#if (eq event.beltlevel "black")}}selected{{/if}}>Black</option>
              </select>


              <label for="gender">Gender:</label>
              <select id="gender" name="gender" rows="4">
                <option value="male" {{#if (eq event.gender "male")}}selected{{/if}}>Male</option>
                <option value="female" {{#if (eq event.gender "female")}}selected{{/if}}>Female</option>
              </select>

              <label for="weightclass">Weight Class:</label>
              <select id="weightclass" name="weightclass" rows="4">
                <option value="54kg">54kg</option>
                <option value="58kg">58kg</option>
                <option value="68kg">68kg</option>
                <option value="74kg">74kg</option>
                <option value="80kg">80kg</option>
                <option value="87kg">87kg</option>
                <option value="87+kg">87+kg</option>
              </select>

              <label for="agedivision">Age Division:</label>
              <select id="agedivision" name="agedivision" rows="4">
                <option value="Youth">Youth</option>
                <option value="Cadet">Cadet</option>
                <option value="Junior">Junior</option>
                <option value="Senior">Senior</option>
                <option value="Ultra">Ultra</option>
              </select>
            </div>
            <div class="form-group">
              <label for="date">Event Date:</label>
              <input type="date" id="date" name="date" value="{{event.date}}">
            </div>
            <div class="form-group">
              <label for="starttime">Start Time:</label>
              <input type="time" id="starttime" name="starttime" value="{{event.starttime}}" required>
              <label for="endtime">End Time:</label>
              <input type="time" id="endtime" name="endtime" value="{{event.endtime}}" required>
            </div>
            <div class="form-group">
              <label for="registrationcap">Registration Cap:</label>
              <input type="number" id="registrationcap" name="registrationcap" value="{{event.registrationcap}}"
                required>
            </div>
            <div class="form-group">
              <label for="location">Location:</label>
              <input type="text" id="location" name="location" value="{{event.location}}" required>
            </div>
            <button onclick="closeModal()" class="cancel">Cancel</button>
            <button type="submit">Update Event</button>
          </form>

        </div>
      </div>
      
      {{!--------------------------------------------------------------------------------- MIDDLE SIDE OF THIS PAGE --------------------------------------------------------------------}}

      <div class="eventmiddleside"> 
      {{#if (eq event.status 'Cancelled')}}
        <h1 style="color: red">This event has been<br> CANCELLED</h1>
      {{else}}
        

          {{#if (eq event.eventtype 'Poomsae')}}
            {{#if poomsaetop4}}
              <h3>Poomsae Winners</h3>
              <div class="leaderboard-list">
              {{#each poomsaetop4}}
                <div class="leaderboard-item {{#if (eq ranking 1)}}first-place{{/if}}">
                <span class="ranking">{{ranking}}</span>
                <span class="name">{{name}}</span>
                <button class="winnersviewathlete" onclick="window.location.href='/athletes-profile/{{athleteid}}'">&#8614;</button>
                </div>
              {{/each}}
              </div>
            {{/if}}
          
          {{else if (eq event.eventtype 'Kyorugi')}}
            {{#if kyorugitop4}}
              <h3>Kyorugi Rankings</h3>
              {{#each kyorugitop4}}
                <p>{{ranking}} {{name}}</p>
              {{/each}}
            {{/if}}
          <div class="ranking">
            <h3>Rankings</h3>
            <div class="rank-item">

              {{#if (eq event.eventtype 'Kyorugi')}}
              {{#if champion}}
              <h4>Champion</h4>
              <p>{{champion.name}}</p>
              <form action="/update-points" method="post">
                <input type="hidden" name="userid" value="{{champion.userid}}">
                <input type="number" name="points" placeholder="Enter points" required>
                <button type="submit">Update Points</button>
              </form>
              {{else}}
              <p>To be decided</p>
              {{/if}}
            </div>

            <div class="rank-item">
              {{#if secondPlace}}
              <h4>2nd Place</h4>
              <p>{{secondPlace.name}}</p>
              <form action="/update-points" method="post">
                <input type="hidden" name="userid" value="{{secondPlace.userid}}">
                <input type="number" name="points" placeholder="Enter points" required>
                <button type="submit">Update Points</button>
              </form>
              {{else}}
              <p>To be decided</p>
              {{/if}}
            </div>

            <div class="rank-item">
              {{#if thirdPlace}}
              <h4>3rd Place</h4>
              <p>{{thirdPlace.name}}</p>
              <form action="/update-points" method="post">
                <input type="hidden" name="userid" value="{{thirdPlace.userid}}">
                <input type="number" name="points" placeholder="Enter points" required>
                <button type="submit">Update Points</button>
              </form>
              {{else}}
              <p>To be decided</p>
              {{/if}}
              {{/if}}
            </div>
          </div>
          {{/if}}

        <div class="schedule">
            {{#if (and user.ptaverified (me registrationcount event.registrationcap ))}}
              {{#if (eq event.status 'Active')}}
                {{#if (eq event.eventtype 'Kyorugi')}}
                <form action="/begin-kyorugi-competition/{{event.id}}" method="post">
                  <button type="submit" class="begincompe">Begin Competition</button>
                </form>
                {{else if (eq event.eventtype 'Poomsae')}}
                <form action="/begin-poomsae-competition/{{event.id}}" method="post">
                  <button type="submit" class="begincompe">Begin Competition</button>
                </form>
                {{/if}}
              {{else if (eq event.status 'Ongoing')}}
                {{#if (le event.currentround 1)}}
                  {{#if (eq event.eventtype 'Poomsae')}}
                  <form action="/next-poomsae-round/{{event.id}}" method="post">
                    <button type="submit" class="begincompe">Proceed to next round</button>
                  </form>
                  {{/if}}
                {{else}}
                  <form action="/decide-poomsae-winners/{{event.id}}" method="post">
                    <button type="submit" class="begincompe">Decide Winners</button>
                  </form>
                {{/if}}
              {{/if}}
            {{/if}}

          <h2>Schedule</h2>
          
          {{#if (eq event.eventtype 'Poomsae')}}
            {{#if sortedGroupedByRound}}
                {{#each sortedGroupedByRound}}
                  <h3>Round: {{@key}}</h3>
                  <table class="schedule-table">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Schedule</th>
                        <th>Total Score</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      {{#each this}}
                        <tr>
                          <td>{{name}}</td>
                          <td>{{schedule}}</td>
                          <td class="totalscore">{{totalscore}}</td>
                          <td>
                            <button onclick="openPoomsaeScoresheet('{{id}}', '{{name}}', '{{totalscore}}', '{{technicalscore}}', '{{performancescore}}')" class="open-poomsae-scoresheet">Open Scoresheet -></button>
                          </td>
                        </tr>
                      {{/each}}
                    </tbody>
                  </table>
                {{/each}}
                {{else}}
              <p>No rounds available.</p>
            {{/if}}
          {{/if}}

          {{#if (eq event.eventtype 'Kyorugi')}}
            <table class="matches-table">
              <thead>
                <tr>
                  <th>Round</th>
                  <th>Match Time</th>
                  <th>Player 1</th>
                  <th>Player 2</th>
                  <th>Scoresheet</th>
                </tr>
              </thead>
              <tbody>
                {{#each matches}}
                  <tr>
                    <td>{{round}}</td>
                    <td>
                      {{#if matchtime}}
                        <p class="match-time">{{matchtime}}</p>
                      {{else}}
                        <form action="/update-matchtime" method="post">
                          <input type="hidden" name="id" value="{{id}}">
                          <input type="hidden" name="eventid" value="{{eventid}}">
                          <input type="time" class="matchtime" name="matchtime">
                          <button type="submit">OK</button>
                        </form>
                      {{/if}}
                    </td>
                    <td>{{player1}}: {{player1score}}</td>
                    <td>{{player2}}: {{player2score}}</td>
                    <td>
                      <button href="#" onclick="openKyorugiScoresheet('{{id}}', '{{player1}}', '{{player2}}', '{{player1score}}', '{{player2score}}', '{{matchtime}}', '{{winner}}', '{{loser}}', '{{matchttype}}', '{{round}}', '{{status}}')" class="open-kyorugi-scoresheet">Scoresheet -></button>
                    </td>
                  </tr>
                {{/each}}
              </tbody>
            </table>
          {{/if}}
        </div>
      
      </div>

      <div class="eventrightside">
        <div class="eventregistercodediv">
          <div class="buttondiv">
            {{#unless champion}}
            {{#if user.athleteverified}}
            {{#unless (or currentregistrant (me registrationcount event.registrationcap))}}
              {{#if (eq event.status 'Active')}}
                <a href="/events-registration/{{event.id}}" class="register-button">Register</a>
              {{else}}
                <h3>This event has been<br> CANCELLED</h3>
              {{/if}}
            {{else if currentregistrant.registered}}
            <p>Your check-in code is:</p>
            <h1 class="code">{{currentregistrant.id}}</h1>
            {{else if currentregistrant}}
            <p>Your check-in code is:</p>
            <h1 class="pending">pending</h1>
            {{else}}
            <h1 class="pending">Registration Limit Reached</h1>
            {{/unless}}
            {{else}}
            <a class="grayed-register-button">Not Registered</a>
            {{/if}}
            {{else}}
            <h1 class="pending">This Competition has</h1>
            <h1 class="pending"> Concluded</h1>
            {{/unless}}
          </div>
        </div>
      </div>
      {{/if}}


      <div class="poomsae-score-sheet">
        <span class="close" onclick="closePoomsaeScoresheet()">&times;</span>
        <h2 class="title">Judge's Score Sheet</h2>
        <h3 class="playername"></h3>
        <div class="score-table">
          <form action="/submit-poomsae-scores" method="post">
          <input type="hidden" name="id" value="">
          <input type="hidden" name="eventid" value="{{event.id}}">
            <table>
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Sub-Category</th>
                  <th>Score Allocation</th>
                  <th>Deductions</th>
                  <th>Final Score</th>
                </tr>
              </thead>
                  <tbody>
                    <tr>
                      <td rowspan="3"><strong>Technical (4.0)</strong></td>
                      <td>Accuracy in basic Movement</td>
                      <td rowspan="3">4.0 (deduct -0.1, -0.3)</td>
                      <td><input type="number" class="deduction-input" name="basicmovement" step="0.1" min="0" max="4" data-max="4"></td>
                      <td class="final-score" data-base="4">4.0</td>
                    </tr>
                    <tr>
                      <td>Accuracy in individual Movement of the Poomsae</td>
                      <td><input type="number" class="deduction-input" name="indivmovement" step="0.1" min="0" max="4" data-max="4" value="0"></td>
                      <td class="final-score" data-base="4">4.0</td>
                    </tr>
                    <tr>
                      <td>Balance</td>
                      <td><input type="number" class="deduction-input" name="balance" step="0.1" min="0" max="4" data-max="4" value="0"></td>
                      <td class="final-score" data-base="4">4.0</td>
                    </tr>
                    <tr>
                      <td rowspan="3"><strong>Performance (6.0)</strong></td>
                      <td>Power & Speed</td>
                      <td>2.0</td>
                      <td><input type="number" class="deduction-input" name="powerspeed" step="0.1" min="0" max="2" data-max="2" value="0"></td>
                      <td class="final-score" data-base="2">2.0</td>
                    </tr>
                    <tr>
                      <td>Coordination of rhythm & Tempo and Softness & Power</td>
                      <td>2.0</td>
                      <td><input type="number" class="deduction-input" name="coord" step="0.1" min="0" max="2" data-max="2" value="0"></td>
                      <td class="final-score" data-base="2">2.0</td>
                    </tr>
                    <tr>
                      <td>Expression of Energy</td>
                      <td>2.0</td>
                      <td><input type="number" class="deduction-input" name="energy" step="0.1" min="0" max="2" data-max="2" value="0"></td>
                      <td class="final-score" data-base="2">2.0</td>
                    </tr>
                    
                  </tbody>
            </table>
            <div class="total-score">
              <strong>Total Score (10.0):</strong> <span id="total-score">10.0</span>
              <button class="submitscores" type="submit">Submit</button>
            </div>
          </form>
        </div>
      </div>

      <div class="kyorugi-scoresheet">
        <span class="close" onclick="closeKyorugiScoresheet()">&times;</span>
        <h1>Kyorugi Scoresheet</h1>
        <div class="match-info">
          <p><strong>Match:</strong> {{player1}} vs {{player2}}</p>
          <p><strong>Time:</strong> {{match.matchtime}}</p>
        </div>
        <div class="scores">
          <h2>Scores</h2>
          <form action="/submit-kyorugi-scores" method="POST">
            <input type="" name="matchid">
            <input type="" name="eventid" value="{{event.id}}">
            <table>
              <thead>
                <tr>
                  <th>Round{{match.eventid}}</th>
                  <th>{{player1}}</th>
                  <th>{{player2}}</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td><input type="number" name="player1_round1" required></td>
                  <td><input type="number" name="player2_round1" required></td>
                </tr>
                <tr>
                  <td>2</td>
                  <td><input type="number" name="player1_round2" ></td>
                  <td><input type="number" name="player2_round2" ></td>
                </tr>
                <tr>
                  <td>3</td>
                  <td><input type="number" name="player1_round3" ></td>
                  <td><input type="number" name="player2_round3" ></td>
                </tr>
                <tr>
                  <td>OT</td>
                  <td><input type="number" name="player1_ot" ></td>
                  <td><input type="number" name="player2_ot" ></td>
                </tr>
                <tr>
                  <td>Total</td>
                  <td><input type="number" name="player1_total" readonly></td>
                  <td><input type="number" name="player2_total" readonly></td>
                </tr>
              </tbody>
            </table>
            <button type="submit">Submit Scores</button>
          </form>
        </div>
      </div>

      <div class="announcements" hidden>
        <h2>Announcements</h2>
        <div class="makeannouncement">
          <button class="newannounce" onclick="openannounceModal()">+ Announce</button>
        </div>
        {{#reverseEach eventannouncements}}
        <div class="oneannouncement">
          <h2>{{title}}</h2>
          <p>{{subject}}</p>
          <p>{{body}}</p>
        </div>
        {{/reverseEach}}
      </div>

      <div id="announceModal" class="modal" style="display:none;">
        <div class="modal-content">
          <span class="close" onclick="closeannounceModal()">&times;</span>
          <form action="/create-event-announcement" method="post" class="announceform">
            <input type="hidden" name="originalposter" value="{{user.username}}">
            <input type="hidden" name="profilepic" value="{{user.profilepic}}">
            <input type="hidden" name="eventid" value="{{event.id}}">

            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>

            <label for="subject">Subject:</label>
            <input type="text" id="subject" name="subject" required>

            <label for="body">Body:</label>
            <textarea id="body" name="body" rows="4" required></textarea>

            <button type="submit" class="submit-announce">Post Announcement</button>
          </form>
        </div>
      </div>

    </div>
  </div>

  <div class="participants-container">
    <div class="participants-title">Participants</div>
    <table class="participants-table">
      <thead>
        <tr>
          <th>Player</th>
          <th>Club</th>
          <th>Height</th>
          <th>Weight</th>
          <th>Scoresheet</th>
        </tr>
      </thead>
      <tbody>
        {{#each participants}}
        <tr>
          <td>{{this.playername}}</td>
          <td>{{this.club}}f</td>
          <td>{{this.height}}</td>
          <td>{{this.weight}}</td>
          <td><a href="google.com">Go to scoresheet</a></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>

  <div class="registrations-container">
    <div class="registrations-title">Pending Registrations</div>
    {{#if pendingregs}}
    <table class="registrations-table">
      <thead>
        <tr>
          <th>Player</th>
          <th>Club</th>
          <th>Height</th>
          <th>Weight</th>
          <th>Registered?</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{#each pendingregs}}
        <tr>
          <td>{{this.playername}}</td>
          <td>{{this.club}}</td>
          <td>{{this.height}}</td>
          <td>{{this.weight}}</td>
          <td>{{this.registered}}</td>
          <td><a href="/events-review-registration/{{this.id}}">review</a></td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{else}}
    <h1>No pending registrations</h1>
    {{/if}}

    <div class="registrations-title">Accepted Registrations</div>
    <table class="registrations-table">
      <thead>
        <tr>
          <th>Player</th>
          <th>Club</th>
          <th>Height</th>
          <th>Weight</th>
          <th>Registered?</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{#each participants}}
        <tr>
          <td>{{this.playername}}</td>
          <td>{{this.club}}</td>
          <td>{{this.height}}</td>
          <td>{{this.weight}}</td>
          <td>{{this.registered}}</td>
          <td><a href="/events-review-registration/{{this.id}}">review</a></td>
        </tr>
        {{/each}}
      </tbody>
    </table>

    
  </div>

  <script>
    function openPoomsaeScoresheet(id, name, totalscore, technicalscore, performancescore) {
      const poomsaeSheet = document.querySelector('.poomsae-score-sheet');
      poomsaeSheet.style.display = 'block';
      poomsaeSheet.querySelector('input[name="id"]').value = id;
      poomsaeSheet.querySelector('.playername').textContent = 'Player name: ' + name;
      document.getElementById('total-score').innerText = totalscore;
    }

    function openKyorugiScoresheet(id, player1, player2, player1score, player2score, matchtime, winner, loser, matchtype, round, status) {
      const kyorugiSheet = document.querySelector('.kyorugi-scoresheet');
      kyorugiSheet.style.display = 'block';
      kyorugiSheet.querySelector('input[name="matchid"]').value = id;
      kyorugiSheet.querySelector('input[name="player1_round1"]').value = player1score || '';
      kyorugiSheet.querySelector('input[name="player2_round1"]').value = player2score || '';
      kyorugiSheet.querySelector('.match-info').innerHTML = `<p><strong>Match:</strong> ${player1} vs ${player2}</p><p><strong>Time:</strong> ${matchtime}</p>`;
    }

    function closeScoresheet(selector) {
      document.querySelector(selector).style.display = 'none';
    }

    function closeKyorugiScoresheet() {
      closeScoresheet('.kyorugi-scoresheet');
    }

    function closePoomsaeScoresheet() {
      closeScoresheet('.poomsae-score-sheet');
    }

    document.querySelectorAll('.deduction-input').forEach(input => {
      input.addEventListener('input', calculateScores);
    });

    function calculateScores() {
      let totalScore = 10.0; // Starting score for Poomsae

      document.querySelectorAll('.deduction-input').forEach(input => {
      const maxScore = parseFloat(input.dataset.max);
      const deduction = parseFloat(input.value) || 0;
      const finalScoreElement = input.parentElement.nextElementSibling;
      const finalScore = Math.max(0, maxScore - deduction); // Avoid negative scores

      // Update the final score display for each row
      finalScoreElement.textContent = finalScore.toFixed(1);

      // Deduct from the total score
      totalScore -= deduction;
      });

      // Update the total score in the UI
      document.getElementById('total-score').textContent = totalScore.toFixed(1);
    }

    document.addEventListener('input', function() {
      let player1_total = 0;
      let player2_total = 0;
      const player1_rounds = document.querySelectorAll('input[name^="player1_round"]');
      const player2_rounds = document.querySelectorAll('input[name^="player2_round"]');
      const player1_ot = document.querySelector('input[name="player1_ot"]');
      const player2_ot = document.querySelector('input[name="player2_ot"]');
      
      player1_rounds.forEach(input => player1_total += parseInt(input.value) || 0);
      player2_rounds.forEach(input => player2_total += parseInt(input.value) || 0);
      
      if (player1_ot) {
      player1_total += parseInt(player1_ot.value) || 0;
      }
      if (player2_ot) {
      player2_total += parseInt(player2_ot.value) || 0;
      }
      
      document.querySelector('input[name="player1_total"]').value = player1_total;
      document.querySelector('input[name="player2_total"]').value = player2_total;
    });

    function toggleDropdown() {
      document.getElementById("dropdown").classList.toggle("show");
    }

    window.onclick = function (event) {
      if (!event.target.matches('.profile-pic img')) {
      document.querySelectorAll(".dropdown-content").forEach(dropdown => {
        if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
        }
      });
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      const tabs = {
      participantsTab: document.getElementById('participants-tab'),
      detailsTab: document.getElementById('details-tab'),
      registrationsTab: document.getElementById('registrations-tab'),
      announcementsTab: document.getElementById('announcements-tab')
      };

      const sections = {
      eventleftside: document.querySelector('.eventleftside'),
      eventrightside: document.querySelector('.eventrightside'),
      eventmiddleside: document.querySelector('.eventmiddleside'),
      participantsContainer: document.querySelector('.participants-container'),
      registrationsContainer: document.querySelector('.registrations-container'),
      announcements: document.querySelector('.announcements')
      };

      function hideAllSections() {
      Object.values(sections).forEach(section => section.style.display = 'none');
      }

      function showSection(section) {
      hideAllSections();
      section.style.display = 'block';
      }

      tabs.participantsTab.addEventListener('click', () => showSection(sections.participantsContainer));
      tabs.detailsTab.addEventListener('click', () => {
      sections.eventleftside.style.display = 'block';
      sections.eventrightside.style.display = 'block';
      sections.eventmiddleside.style.display = 'block';
      sections.participantsContainer.style.display = 'none';
      sections.registrationsContainer.style.display = 'none';
      sections.announcements.style.display = 'none';
      });
      tabs.registrationsTab.addEventListener('click', () => showSection(sections.registrationsContainer));
      tabs.announcementsTab.addEventListener('click', () => showSection(sections.announcements));
    });

    function openModal() {
      document.getElementById('editmodal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('editmodal').style.display = 'none';
    }

    function openannounceModal() {
      document.getElementById('announceModal').style.display = 'block';
    }
    
    function closeannounceModal() {
      document.getElementById('announceModal').style.display = 'none';
    }
    
    function confirmDelete() {
      document.querySelector('.confirmdeletescreen').style.display = 'block';
      document.querySelector('.deleteevent-button').style.display = 'none';
    }

    function cancelDelete() {
      document.querySelector('.confirmdeletescreen').style.display = 'none';
      document.querySelector('.deleteevent-button').style.display = 'block';
    }

    window.onclick = function (event) {
      if (event.target == document.getElementById('announceModal')) {
      closeannounceModal();
      }
    }

  </script>
</body>

</html>