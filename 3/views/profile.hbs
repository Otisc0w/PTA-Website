<!DOCTYPE html>
<html>
<head>
    <title>PTA | Profile</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/profile.css" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/navbar.css" />
</head>
<body class="container">
    <div class="header">
        <div class="navbar">
            <a href="home"><img src="/images/logo.png" class="logo" alt="Logo"></a>
            <ul class="tabs">
                <li class="home"><a href="home">Home</a></li>
                <li class="athletes"><a href="athletes">Athletes</a></li>
                <li class="clubs"><a href="clubs">Clubs</a></li>
                <li class="events"><a href="events">Events</a></li>
                <li class="membership"><a href="membership">Membership</a></li>
                <li class="forum"><a href="forum">Forum</a></li>
                <li class="notifications">
                    <a href="notifications">Notifications <span class="badge">3</span></a>
                </li>
                <li class="profile-pic">
                    {{#if user.profilepic}}
                        <a href="#" onclick="toggleDropdown()"><img src="{{user.profilepic}}" alt="Profile Picture" class="profile-picture"></a>
                    {{else}}
                        <a href="#" onclick="toggleDropdown()" class="profile-picture"><img src="/images/none.jpg" alt="Profile Picture" class="profile-picture"></a>
                    {{/if}}
                    <div id="dropdown" class="dropdown-content">
                        <a href="profile?tab=viewProfile">Profile</a>
                        <a href="settings">Settings</a>
                        <a href="/">Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="profile-container">
        <div class="side-nav">
            <ul>
                <li><a href="profile?tab=viewProfile" id="viewProfileLink">View Profile</a></li>
                <li><a href="profile?tab=editProfile" id="editProfileLink">Edit Profile</a></li>
                <li><a href="profile?tab=notificationSettings" id="notificationSettingsLink">Notification Settings</a></li>
                <li><a href="profile?tab=securitySettings" id="securitySettingsLink">Security Settings</a></li>
            </ul>
        </div>
        <div class="profile-content">
            <div id="editProfile" class="profile-section">
                <h2>Edit Profile</h2>
                <div class="profile-pic-section">
                    {{#if user.profilepic}}
                        <img src="{{user.profilepic}}" alt="Profile Picture" class="profile-picture">
                    {{else}}
                        <img src="/images/none.jpg" alt="Profile Picture" class="profile-picture">
                    {{/if}}
                    <button class="edit-profile-pic" onclick="changeProfilePic()">Edit</button>
                </div>
                <form>
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" value="Paula">
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" value="Pineda">
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" value="paula@example.com">
                    </div>
                    <div class="form-group">
                        <label for="address">Address:</label>
                        <input type="text" id="address">
                    </div>
                    <div class="form-group">
                        <label for="contactNumber">Contact Number:</label>
                        <input type="text" id="contactNumber">
                    </div>
                    <div class="form-group">
                        <label for="region">Region:</label>
                        <input type="text" id="region" value="MIMAROPA">
                    </div>
                    <div class="form-group">
                        <label for="club">Club:</label>
                        <input type="text" id="club" value="Saitama Club">
                    </div>
                    <div class="form-actions">
                        <button class="cancel-button" onclick="window.location.href='profile'">Cancel</button>
                        <button class="save-button" type="submit">Save Changes</button>
                    </div>
                </form>
            </div>
            <div id="viewProfile" class="profile-section" style="display:none;">
                <h2>View Profile</h2>
                <div class="profile-pic-section">
                    {{#if user.profilepic}}
                        <img src="{{user.profilepic}}" alt="Profile Picture" class="profile-picture">
                    {{else}}
                        <img src="/images/none.jpg" alt="Profile Picture" class="profile-picture">
                    {{/if}}
                </div>
                <form>
                    <div class="form-group">
                        <label for="viewFirstName">First Name:</label>
                        <input type="text" id="viewFirstName" value="Paula" readonly>
                    </div>
                    <div class="form-group">
                        <label for="viewLastName">Last Name:</label>
                        <input type="text" id="viewLastName" value="Pineda" readonly>
                    </div>
                    <div class="form-group">
                        <label for="viewEmail">Email:</label>
                        <input type="email" id="viewEmail" value="paula@example.com" readonly>
                    </div>
                    <div class="form-group">
                        <label for="viewAddress">Address:</label>
                        <input type="text" id="viewAddress" readonly>
                    </div>
                    <div class="form-group">
                        <label for="viewContactNumber">Contact Number:</label>
                        <input type="text" id="viewContactNumber" readonly>
                    </div>
                    <div class="form-group">
                        <label for="viewRegion">Region:</label>
                        <input type="text" id="viewRegion" value="MIMAROPA" readonly>
                    </div>
                    <div class="form-group">
                        <label for="viewClub">Club:</label>
                        <input type="text" id="viewClub" value="Saitama Club" readonly>
                    </div>
                </form>
            </div>
            <div id="notificationSettings" class="profile-section" style="display:none;">
                <h2>Notification Settings</h2>
                <form id="notificationSettingsForm" onsubmit="return saveNotificationSettings()">
                    <div class="notification-category">
                        <h3>Notifications from us</h3>
                        <label>
                            <input type="checkbox" name="notifications" value="newsUpdates">
                            News and updates
                        </label>
                        <label>
                            <input type="checkbox" name="notifications" value="tipsTutorials">
                            Tips and tutorials
                        </label>
                        <label>
                            <input type="checkbox" name="notifications" value="userResearch">
                            User research
                        </label>
                    </div>
                    <div class="notification-category">
                        <h3>Comments</h3>
                        <label>
                            <input type="radio" name="comments" value="none">
                            Do not notify me
                        </label>
                        <label>
                            <input type="radio" name="comments" value="mentionsOnly">
                            Mentions only
                        </label>
                        <label>
                            <input type="radio" name="comments" value="all">
                            All comments
                        </label>
                    </div>
                    <div class="notification-category">
                        <h3>Reminders</h3>
                        <label>
                            <input type="radio" name="reminders" value="none">
                            Do not notify me
                        </label>
                        <label>
                            <input type="radio" name="reminders" value="importantOnly">
                            Important reminders only
                        </label>
                        <label>
                            <input type="radio" name="reminders" value="all">
                            All reminders
                        </label>
                    </div>
                    <div class="notification-category">
                        <h3>More activity about you</h3>
                        <label>
                            <input type="radio" name="moreActivity" value="none">
                            Do not notify me
                        </label>
                        <label>
                            <input type="radio" name="moreActivity" value="all">
                            Notify me for all other activity
                        </label>
                    </div>
                    <div class="form-actions">
                        <button class="save-button" type="submit">Save</button>
                        <button class="cancel-button" type="button" onclick="window.location.href='profile'">Cancel</button>
                    </div>
                </form>
            </div>
            <div id="securitySettings" class="profile-section" style="display:none;">
                <h2>Security Settings</h2>
                <div class="change-password-section">
                    <h3>Change Password</h3>
                    <form id="changePasswordForm" onsubmit="return submitPasswordChange()">
                        <div class="form-group">
                            <label for="currentPassword">Current Password:</label>
                            <input type="password" id="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password:</label>
                            <input type="password" id="newPassword" oninput="validatePassword()" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password:</label>
                            <input type="password" id="confirmPassword" oninput="validatePassword()" required>
                        </div>
                        <div id="passwordError" class="error-message" style="display:none; color: red;">Passwords do not match</div>
                        <div class="form-actions">
                            <button class="save-button" type="submit">Save</button>
                            <button class="cancel-button" type="button" onclick="window.location.href='profile'">Cancel</button>
                        </div>
                    </form>
                    <div class="password-requirements">
                        <h4>Passwords must contain:</h4>
                        <ul>
                            <li id="char-length">✔ At least 6 characters</li>
                            <li id="uppercase-letter">✔ At least 1 uppercase letter (A-Z)</li>
                            <li id="lowercase-letter">✔ At least 1 lowercase letter (a-z)</li>
                            <li id="number">✔ At least 1 number (0-9)</li>
                            <li id="symbol">✔ At least 1 symbol (!@#$%^&* etc.)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function toggleDropdown() {
            document.getElementById("dropdown").classList.toggle("show");
        }

        window.onclick = function(event) {
            if (!event.target.matches('.profile-pic img')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        function setActiveTab() {
            const params = new URLSearchParams(window.location.search);
            const tab = params.get('tab') || 'viewProfile';
            document.querySelectorAll('.profile-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(tab).style.display = 'block';
            document.querySelectorAll('.side-nav ul li a').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(tab + 'Link').classList.add('active');
        }

        window.onload = setActiveTab;

        function validatePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            let isValid = true;

            // Validation criteria
            const criteria = {
                charLength: newPassword.length >= 6,
                uppercaseLetter: /[A-Z]/.test(newPassword),
                lowercaseLetter: /[a-z]/.test(newPassword),
                number: /[0-9]/.test(newPassword),
                symbol: /[!@#$%^&*(),.?":{}|<>]/.test(newPassword)
            };

            // Update UI for criteria
            for (const criterion in criteria) {
                const element = document.getElementById(criterion.replace(/[A-Z]/g, letter => '-' + letter.toLowerCase()));
                if (criteria[criterion]) {
                    element.classList.add('valid');
                    element.classList.remove('invalid');
                } else {
                    element.classList.add('invalid');
                    element.classList.remove('valid');
                    isValid = false;
                }
            }

            // Confirm password match
            if (newPassword !== confirmPassword) {
                isValid = false;
                document.getElementById('passwordError').style.display = 'block';
            } else {
                document.getElementById('passwordError').style.display = 'none';
            }

            return isValid;
        }

        function submitPasswordChange() {
            if (validatePassword()) {
                // Perform password change logic here
                // For example, send an AJAX request to your server to change the password
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;

                fetch('/change-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ currentPassword, newPassword })
                }).then(response => {
                    if (response.ok) {
                        alert('Password changed successfully');
                        window.location.href = 'profile';
                    } else {
                        alert('Failed to change password');
                    }
                }).catch(error => {
                    console.error('Error:', error);
                    alert('Failed to change password');
                });

                return false; // Prevent form submission
            }
            return false; // Prevent form submission if validation fails
        }

        function saveNotificationSettings() {
            // Implement saving logic here
            const formData = new FormData(document.getElementById('notificationSettingsForm'));
            const settings = {};
            formData.forEach((value, key) => {
                if (!settings[key]) {
                    settings[key] = [];
                }
                settings[key].push(value);
            });

            fetch('/save-notification-settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(settings)
            }).then(response => {
                if (response.ok) {
                    alert('Notification settings saved successfully');
                } else {
                    alert('Failed to save notification settings');
                }
            }).catch(error => {
                console.error('Error:', error);
                alert('Failed to save notification settings');
            });

            return false; // Prevent form submission
        }
    </script>
</body>
</html>
