<!DOCTYPE html>
<html>

<head>
    <title>PTA | Analytics</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/home.css" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/navbar.css" />
    <link rel="stylesheet" type="text/css" href="../stylesheets/analytics.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>

<body class="container">
    <div class="header">
        <div class="navbar">
            <a href="home"><img src="/images/logo.png" class="logo" alt="Logo"></a>
            <ul class="tabs">
                <li class="home"><a href="home">Home</a></li>
                <li class="athletes"><a href="athletes">Athletes</a></li>
                <li class="clubs"><a href="clubs">Clubs</a></li>
                <li class="events"><a href="events">Events</a></li>
                <li class="membership"><a href="membership">Membership</a></li>
                <li class="forum"><a href="forum">Forum</a></li>
                <li class="notifications">
                    <a href="notifications">Notifications
                        {{#if notifications}}
                        <span class="badge">{{notifications.length}}</span>
                        {{/if}}
                    </a>
                </li>
                <li class="analytics"><a href="analytics">Analytics</a></li>
                <li class="profile-pic">
                    {{#if user.profilepic}}
                    <a href="#" onclick="toggleDropdown()"><img src="{{user.profilepic}}" alt="Profile Picture"
                            class="profile-picture"></a>
                    {{else}}
                    <a href="#" onclick="toggleDropdown()" class="profile-picture"><img src="/images/none.jpg"
                            alt="Profile Picture" class="profile-picture"></a>
                    {{/if}}
                    <div id="dropdown" class="dropdown-content">
                        <a href="profile">Profile</a>
                        <a href="settings">Settings</a>
                        <a href="help-center">FAQs</a>
                        <a href="/">Logout</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Filter and Create Report Section -->
    <div class="action-bar">
        <div class="filter-panel">
            <div class="filter-group">
                <label for="date-today">Date Today:</label>
                <input type="text" id="date-today" placeholder="Search...">
            </div>
            <div class="filter-group">
                <label for="start-date">Start Date</label>
                <input type="text" id="start-date" class="datepicker">
            </div>
            <div class="filter-group">
                <label for="end-date">End Date</label>
                <input type="text" id="end-date" class="datepicker">
            </div>

            <button class="apply-btn">Apply</button>
        </div>
        <button type="button" class="create-report-button" onclick="openModal()">+ Create Report</button>
    </div>

    <div class="analytics-container">
        <div class="card summary-card">
            <div class="header">Summary</div>
            <ul class="summary-list">
                <li>
                    <span onclick="displayReportTitles('top-performers')">Top Performers of the Year</span>
                    <div id="top-performers-titles" class="report-titles"></div>
                </li>
                <li>
                    <span onclick="displayReportTitles('upcoming-events')">Total Events in the Year</span>
                    <div id="upcoming-events-titles" class="report-titles"></div>
                </li>
                <li>
                    <span onclick="displayReportTitles('clubs')">Total Clubs in a year</span>
                    <div id="clubs-titles" class="report-titles"></div>
                </li>
                <li>
                    <span onclick="displayReportTitles('member-engagement')">Total Participants in a year</span>
                    <div id="member-engagement-titles" class="report-titles"></div>
                </li>
            </ul>
            <button class="see-more-button">See more</button>
        </div>



        <div class="card top-performers-card" id="top-performers-list">
            <div class="header">Top Performers</div>
            <ul id="top-performers-content"></ul>
        </div>

        <div class="card upcoming-events-card" id="upcoming-events-list">
            <div class="header">Upcoming Events</div>
            <ul id="upcoming-events-content">
            </ul>
        </div>

        <div class="card clubs-card" id="clubs-list">
            <div class="header">Clubs</div>
            <ul id="clubs-content"></ul>
        </div>

        <div class="card member-engagement-card" id="member-engagement-list">
            <div class="header">Member Engagement</div>
            <ul id="member-engagement-content">
            </ul>
        </div>
    </div>

    <div id="createReportModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2>Create Report</h2>

            <!-- Report Form -->
            <form class="report-form">
                <div class="form-group">
                    <label for="report-title">Report Title:</label>
                    <input type="text" id="report-title" placeholder="Enter report title">
                </div>

                <div class="form-group">
                    <label for="report-description">Description:</label>
                    <textarea id="report-description" placeholder="Enter report description"></textarea>
                </div>

                <div class="form-group">
                    <label for="report-start-date">Start Date:</label>
                    <input type="text" id="report-start-date" class="datepicker">
                    <label for="report-end-date">End Date:</label>
                    <input type="text" id="report-end-date" class="datepicker">
                </div>

                <div class="form-group">
                    <label for="report-type">Report Type:</label>
                    <select id="report-type">
                        <option value="top-performers">Top Performers</option>
                        <option value="upcoming-events">Upcoming Events</option>
                        <option value="clubs">Clubs</option>
                        <option value="member-engagement">Member Engagement</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="report-format">Format:</label>
                    <select id="report-format">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="word">Word</option>
                    </select>
                </div>

                <button type="button" class="submit-report-button" onclick="submitReport()">Submit Report</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="pta-logo">
                <img src="/images/logo.png" alt="PTA Logo">
            </div>
            <div class="contact-info">
                <p>Philippine Taekwondo Central Headquarters</p>
                <p>Rizal Memorial Coliseum, Manila, Philippines</p>
                <p>0977 384 5879</p>
                <p>pthtkd@gmail.com</p>
            </div>
            <div class="social-media">
                <p>Follow us</p>
                <div class="icons">
                    <a href="https://www.facebook.com"><img src="/images/homepage/fb.png" alt="Facebook"></a>
                    <a href="https://www.instagram.com"><img src="/images/homepage/ig.png" alt="Instagram"></a>
                    <a href="https://www.twitch.com"><img src="/images/homepage/twitch.webp" alt="Twitch"></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        function toggleDropdown() {
            document.getElementById("dropdown").classList.toggle("show");
        }

        window.onclick = function (event) {
            if (!event.target.matches('.profile-pic img')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const today = new Date();
            const formattedDate = today.toISOString().split("T")[0]; // YYYY-MM-DD format
            document.getElementById("date-today").value = formattedDate;

            flatpickr(".datepicker", {
                dateFormat: "Y-m-d", // Format as YYYY-MM-DD
                allowInput: true // Allow manual input as well
            });
        });

        var modal = document.getElementById("createReportModal");

        function openModal() {
            modal.style.display = "flex";
        }

        function closeModal() {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        function submitReport() {
            const reportTitle = document.getElementById("report-title").value;
            const reportDescription = document.getElementById("report-description").value;
            const reportStartDate = document.getElementById("report-start-date").value;
            const reportEndDate = document.getElementById("report-end-date").value;
            const reportType = document.getElementById("report-type").value;

            // Create a report object with all details
            const report = {
                title: reportTitle,
                description: reportDescription,
                startDate: reportStartDate,
                endDate: reportEndDate,
                type: reportType
            };

            // Save the report to local storage
            saveReportToLocalStorage(report);

            // Add the report to the UI
            addReportToUI(report);

            // Clear form inputs after submission
            document.getElementById("report-title").value = "";
            document.getElementById("report-description").value = "";
            document.getElementById("report-start-date").value = "";
            document.getElementById("report-end-date").value = "";
            document.getElementById("report-type").value = "";
            document.getElementById("report-format").value = "pdf";

            closeModal();
        }

        function saveReportToLocalStorage(report) {
            // Get existing reports from local storage or initialize an empty array
            let reports = JSON.parse(localStorage.getItem("reports")) || [];
            // Add the new report
            reports.push(report);
            // Save back to local storage
            localStorage.setItem("reports", JSON.stringify(reports));
        }

        function addReportToUI(report) {
            let listItem = document.createElement("li");

            // Create elements for each part of the report and add classes for styling
            let titleElement = document.createElement("span");
            titleElement.classList.add("report-title");
            titleElement.textContent = report.title;

            let descriptionElement = document.createElement("span");
            descriptionElement.classList.add("report-description");
            descriptionElement.textContent = report.description;

            let dateElement = document.createElement("span");
            dateElement.classList.add("report-date");
            dateElement.textContent = `(From: ${report.startDate} To: ${report.endDate})`;

            // Append each part to the list item
            listItem.appendChild(titleElement);
            listItem.appendChild(descriptionElement);
            listItem.appendChild(dateElement);

            // Add the list item to the appropriate section
            switch (report.type) {
                case "top-performers":
                    document.getElementById("top-performers-content").appendChild(listItem);
                    break;
                case "upcoming-events":
                    document.getElementById("upcoming-events-content").appendChild(listItem);
                    break;
                case "clubs":
                    document.getElementById("clubs-content").appendChild(listItem);
                    break;
                case "member-engagement":
                    document.getElementById("member-engagement-content").appendChild(listItem);
                    break;
                default:
                    alert("Invalid report type.");
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const today = new Date();
            const formattedDate = today.toISOString().split("T")[0];
            document.getElementById("date-today").value = formattedDate;

            flatpickr(".datepicker", {
                dateFormat: "Y-m-d",
                allowInput: true
            });

            // Load reports from local storage and display them
            loadReportsFromLocalStorage();
        });

        function loadReportsFromLocalStorage() {
            let reports = JSON.parse(localStorage.getItem("reports")) || [];
            reports.forEach(report => {
                addReportToUI(report);
            });
        }
function displayReportTitles(reportType) {
    // Clear previous content from all report title display areas
    document.querySelectorAll(".report-titles").forEach(div => div.innerHTML = "");

    // Determine the target element to display report titles based on report type
    let targetDiv;
    switch (reportType) {
        case "top-performers":
            targetDiv = document.getElementById("top-performers-titles");
            break;
        case "upcoming-events":
            targetDiv = document.getElementById("upcoming-events-titles");
            break;
        case "clubs":
            targetDiv = document.getElementById("clubs-titles");
            break;
        case "member-engagement":
            targetDiv = document.getElementById("member-engagement-titles");
            break;
        default:
            return;
    }

    // Retrieve the reports from local storage and filter by type
    let reports = JSON.parse(localStorage.getItem("reports")) || [];
    let filteredReports = reports.filter(report => report.type === reportType);

    // Populate the target div with the titles of the filtered reports
    if (filteredReports.length > 0) {
        filteredReports.forEach(report => {
            let titleElement = document.createElement("div");
            titleElement.classList.add("report-title-item");
            titleElement.textContent = report.title;
            targetDiv.appendChild(titleElement);
        });
    } else {
        // If no reports are found, display a message
        let noReportsMessage = document.createElement("div");
        noReportsMessage.classList.add("no-reports-message");
        noReportsMessage.textContent = "No reports available for this category.";
        targetDiv.appendChild(noReportsMessage);
    }
}


    </script>
</body>

</html>